# LVM管理和ssm存储管理器使用

1. LVM的工作原理
2. 创建LVM的基本步骤
3. 实战-使用SSM工具为公司的邮件服务器创建可动态扩容的存储池

> 实战场景：对于生产环境下的服务器来说,如果存储数据的分区磁盘空间不够了怎么办?
> ![](https://i.loli.net/2019/02/28/5c7778440fe30.png)
> 
>答：只能换一个更大的磁盘。 如果用了一段时间后， 空间又不够了，怎么办？再加一块更大的？换磁盘的过程中，还需要把数据从一个硬盘复制到另一个硬盘，过程太慢了。
> 
> 解决方案：使用LVM在线动态扩容


# 1. LVM的工作原理
  LVM（ Logical Volume Manager）逻辑卷管理，是在磁盘分区和文件系统之间添加的一个逻辑层，为文件系统屏蔽下层磁盘分区布局，提供一个抽象的盘卷，在盘卷上建立文件系统。
  
  管理员利用LVM可以在磁盘不用重新分区的情况下动态调整文件系统的大小，并且利用LVM管理的文件系统可以跨越磁盘，当服务器添加了新的磁盘后，管理员不必将原有的文件移动到新的磁盘上，而是通过LVM可以直接扩展文件系统跨越磁盘。
  
  它就是通过将底层的物理硬盘封装起来，然后以逻辑卷的方式呈现给上层应用。在LVM中，其通过对底层的硬盘进行封装，当我们对底层的物理硬盘进行操作时，其不再是针对于分区进行操作，而是通过一个叫做逻辑卷的东西来对其进行底层的磁盘管理操作。

## 1.1 LVM常用的术语
- 物理存储介质（The physical media）:LVM存储介质可以是整个磁盘，磁盘分区，RAID阵列或SAN磁盘，设备必须初始化为LVM物理卷，才能与LVM结合使用 
- 物理卷PV（physical volume）：物理卷就是LVM的基本存储逻辑块，但和基本的物理存储介质（如分区、磁盘等）比较，却包含有与LVM相关的管理参数,创建物理卷它可以用硬盘分区，也可以用硬盘本身
  - PE（physical extents）：PV物理卷中可以分配的最小存储单元，PE的大小是可以指定的，默认为4MB
- 卷组VG（Volume Group）：一个LVM卷组由一个或多个物理卷组成
- 逻辑卷LV（logical volume）：LV建立在VG之上，可以在LV之上建立文件系统
  - LE（logical extent）：LV逻辑卷中可以分配的最小存储单元，在同一个卷组中，LE的大小和PE是相同的，并且一一对应
  
最小存储单位总结：

|名称|     	最小存储单位|命令|
|-|-|-|
|硬盘    |扇区（512字节）|    
|文件系统 |block（1K或4K）| mkfs.ext4  -b 2048  /dev/sdb1  ，最大支持到4096 |
|raid    | 	chunk（512K）| #mdadm -C -v /dev/md5 -l 5 -n 3 -c 512 -x 1 /dev/sde{1,2,3,5}|
|LVM     |	PE 4M）| vgcreate -s 4M  vg1 /dev/sdb{1,2}|

